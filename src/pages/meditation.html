<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VisionFocus Hours Â· æ˜Ÿçƒå†¥æƒ³å¼•å¯¼</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&family=ZCOOL+QingKe+HuangYou&family=ZCOOL+XiaoWei&family=Noto+Serif+SC:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-light: #FFF9F0;
            --primary-warm: #FFEEDD;
            --accent-pink: #FFB6C1;
            --accent-gold: #FFD700;
            --accent-purple: #DDA0DD;
            --text-brown: #8B4513;
            --text-dark: #5D4037;
            --shadow-soft: rgba(255, 182, 193, 0.2);
            --border-radius: 20px;
            --transition-slow: 0.8s ease;
            --transition-normal: 0.4s ease;
            --noise-color: #FF6347;
            --focus-color: #6A5ACD;
            --star-color: #FFD93D;
            --night-blue: #0A0A1A;
            --planet-1: #4ECDC4;
            --earth-blue: #1E88E5;
            --earth-green: #4CAF50;
            --earth-brown: #8D6E63;
            --meditation-blue: #0F2B46;
            --meditation-green: #2D5A4B;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Serif SC', 'ZCOOL XiaoWei', serif;
            background-color: var(--night-blue);
            color: #F0F0F0;
            overflow: hidden;
            min-height: 100vh;
        }

        /* å†¥æƒ³æ°›å›´èƒŒæ™¯ */
        .meditation-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            overflow: hidden;
        }

        .bg-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            transition: opacity 2s ease;
        }

        .layer-universe {
            background: 
                radial-gradient(circle at 20% 30%, rgba(106, 90, 205, 0.1) 0%, transparent 40%),
                radial-gradient(circle at 80% 70%, rgba(255, 107, 139, 0.1) 0%, transparent 40%);
        }

        .layer-forest {
            background: 
                radial-gradient(circle at 30% 40%, rgba(45, 90, 75, 0.2) 0%, transparent 50%),
                radial-gradient(circle at 70% 60%, rgba(31, 78, 47, 0.15) 0%, transparent 50%);
            opacity: 0;
        }

        .layer-sunlight {
            background: 
                radial-gradient(circle at 30% 30%, rgba(255, 215, 0, 0.05) 0%, transparent 70%);
            opacity: 0;
        }

        .layer-stars {
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><circle cx="50" cy="50" r="0.5" fill="white" opacity="0.3"/></svg>');
            background-size: 200px 200px;
            opacity: 0.2;
        }

        /* ä¸»å®¹å™¨ */
        .planet-creation-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10;
            overflow: hidden;
        }

        /* å®‡å®™èšç„¦åŠ¨ç”»å®¹å™¨ */
        .universe-focus-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: all 3s cubic-bezier(0.4, 0, 0.2, 1);
            transform-origin: center;
        }

        /* åˆå§‹å®‡å®™è§†å›¾ */
        .initial-universe {
            width: 100%;
            height: 100%;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .universe-title {
            font-family: 'Ma Shan Zheng', cursive;
            font-size: 4rem;
            color: var(--star-color);
            text-align: center;
            margin-bottom: 30px;
            text-shadow: 
                0 0 10px rgba(255, 217, 0, 0.5),
                0 0 20px rgba(255, 217, 0, 0.3);
            position: relative;
            z-index: 2;
        }

        .universe-instruction {
            font-size: 1.5rem;
            text-align: center;
            max-width: 800px;
            margin-bottom: 40px;
            line-height: 1.6;
            color: #E0E0E0;
            position: relative;
            z-index: 2;
        }

        .highlight {
            color: var(--star-color);
            font-weight: bold;
            text-shadow: 0 0 5px rgba(255, 217, 0, 0.5);
        }

        /* æ˜Ÿçƒå®¹å™¨ */
        .planet-container {
            position: relative;
            width: 300px;
            height: 300px;
            margin: 30px 0;
            transition: all 3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .new-planet {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, var(--planet-1), #2A8C82);
            border: 3px solid var(--planet-1);
            box-shadow: 
                inset 0 0 30px rgba(255, 255, 255, 0.1),
                0 0 60px rgba(78, 205, 196, 0.5);
            position: relative;
            overflow: hidden;
            animation: planet-glow 4s infinite alternate;
        }

        @keyframes planet-glow {
            0% { box-shadow: inset 0 0 30px rgba(255, 255, 255, 0.1), 0 0 60px rgba(78, 205, 196, 0.5); }
            100% { box-shadow: inset 0 0 40px rgba(255, 255, 255, 0.2), 0 0 80px rgba(78, 205, 196, 0.8); }
        }

        .planet-surface {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background-image: 
                radial-gradient(circle at 20% 30%, rgba(255, 255, 255, 0.1) 2%, transparent 4%),
                radial-gradient(circle at 70% 70%, rgba(255, 255, 255, 0.1) 1%, transparent 3%),
                radial-gradient(circle at 40% 60%, rgba(255, 255, 255, 0.05) 3%, transparent 5%);
        }

        .planet-name {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2.5rem;
            color: white;
            font-weight: bold;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.8);
            z-index: 3;
        }

        /* å†¥æƒ³ç©ºé—´ */
        .meditation-space {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 20;
            padding: 20px;
        }

        .meditation-content {
            position: relative;
            z-index: 2;
            max-width: 900px;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .meditation-title {
            font-family: 'Ma Shan Zheng', cursive;
            font-size: 3.5rem;
            color: var(--planet-1);
            text-align: center;
            margin-bottom: 10px;
            text-shadow: 
                0 0 10px rgba(78, 205, 196, 0.5),
                0 0 20px rgba(78, 205, 196, 0.3);
        }

        .meditation-subtitle {
            font-size: 1.5rem;
            color: #CCCCCC;
            text-align: center;
            margin-bottom: 30px;
            font-weight: 300;
        }

        /* å†¥æƒ³å¼•å¯¼åŒºåŸŸ */
        .meditation-guide-container {
            width: 100%;
            max-width: 800px;
            background-color: rgba(15, 25, 35, 0.7);
            border-radius: 20px;
            padding: 40px;
            margin: 20px 0;
            border: 1px solid rgba(78, 205, 196, 0.2);
            backdrop-filter: blur(10px);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4);
            position: relative;
            overflow: hidden;
        }

        .guide-section {
            display: none;
            flex-direction: column;
            animation: fadeIn 1s ease;
        }

        .guide-section.active {
            display: flex;
        }

        .guide-section-title {
            font-size: 2rem;
            color: var(--planet-1);
            margin-bottom: 20px;
            text-align: center;
            font-family: 'Ma Shan Zheng', cursive;
        }

        .guide-text-container {
            min-height: 300px;
            max-height: 400px;
            overflow-y: auto;
            padding-right: 15px;
        }

        .guide-text {
            font-size: 1.5rem;
            line-height: 1.8;
            color: #F0F0F0;
            margin-bottom: 20px;
            font-weight: 300;
        }

        .guide-line {
            margin-bottom: 20px;
            opacity: 0;
            transform: translateY(10px);
            animation: fadeInUp 0.8s forwards;
        }

        .guide-line.pause-line {
            margin-bottom: 40px;
        }

        .guide-line.highlight {
            color: var(--planet-1);
            font-weight: 400;
        }

        .pause-indicator {
            display: inline-block;
            width: 20px;
            height: 20px;
            margin: 0 10px;
            vertical-align: middle;
        }

        .pause-indicator::after {
            content: "â¸";
            color: var(--planet-1);
            font-size: 1.2rem;
            opacity: 0.7;
        }

        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* è¿›åº¦æŒ‡ç¤º */
        .guide-progress {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .section-indicator {
            display: flex;
            flex-direction: column;
            align-items: center;
            flex: 1;
            position: relative;
        }

        .section-indicator::after {
            content: "";
            position: absolute;
            top: 15px;
            left: 50%;
            width: 100%;
            height: 2px;
            background-color: rgba(255, 255, 255, 0.1);
            z-index: 1;
        }

        .section-indicator:last-child::after {
            display: none;
        }

        .section-dot {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.5);
            z-index: 2;
            transition: all 0.5s;
        }

        .section-dot.active {
            background-color: var(--planet-1);
            border-color: var(--planet-1);
            color: white;
            box-shadow: 0 0 15px rgba(78, 205, 196, 0.5);
        }

        .section-dot.completed {
            background-color: rgba(78, 205, 196, 0.3);
            border-color: var(--planet-1);
            color: var(--planet-1);
        }

        .section-label {
            margin-top: 10px;
            font-size: 0.9rem;
            color: #CCCCCC;
            text-align: center;
        }

        /* æ§åˆ¶é¢æ¿ */
        .control-panel {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .control-btn {
            background-color: rgba(15, 25, 35, 0.8);
            border: 2px solid var(--planet-1);
            border-radius: 50px;
            padding: 12px 24px;
            font-size: 1.2rem;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
            min-width: 180px;
            justify-content: center;
        }

        .control-btn:hover {
            background-color: rgba(78, 205, 196, 0.2);
            transform: translateY(-3px);
        }

        .control-btn.active {
            background-color: rgba(78, 205, 196, 0.3);
            box-shadow: 0 0 15px rgba(78, 205, 196, 0.5);
        }

        .control-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .control-btn:disabled:hover {
            background-color: rgba(15, 25, 35, 0.8);
        }

        .btn-icon {
            font-size: 1.3rem;
        }

        /* éŸ³é¢‘æ§åˆ¶ */
        .audio-controls {
            position: fixed;
            bottom: 30px;
            right: 30px;
            display: flex;
            gap: 15px;
            z-index: 30;
        }

        .audio-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: rgba(15, 25, 35, 0.9);
            border: 2px solid var(--planet-1);
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s;
            color: var(--planet-1);
            font-size: 1.5rem;
        }

        .audio-btn:hover {
            background-color: rgba(78, 205, 196, 0.2);
            transform: scale(1.1);
        }

        .audio-btn.active {
            background-color: rgba(78, 205, 196, 0.3);
            box-shadow: 0 0 15px rgba(78, 205, 196, 0.5);
        }

        /* å‘¼å¸åŠ¨ç”» */
        .breathing-circle {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 200px;
            height: 200px;
            border-radius: 50%;
            border: 2px solid rgba(78, 205, 196, 0.2);
            animation: breathe 8s infinite ease-in-out;
            z-index: 1;
            pointer-events: none;
            opacity: 0;
        }

        @keyframes breathe {
            0%, 100% { 
                transform: translate(-50%, -50%) scale(1); 
                border-color: rgba(78, 205, 196, 0.2);
            }
            50% { 
                transform: translate(-50%, -50%) scale(1.3); 
                border-color: rgba(78, 205, 196, 0.5);
            }
        }

        /* å®Œæˆéƒ¨åˆ† */
        .completion-section {
            display: none;
            flex-direction: column;
            align-items: center;
            margin-top: 40px;
            animation: fadeIn 1s ease;
            position: relative;
            z-index: 20;
        }

        .completion-title {
            font-size: 2.5rem;
            color: var(--planet-1);
            margin-bottom: 20px;
            text-align: center;
        }

        .completion-text {
            font-size: 1.3rem;
            text-align: center;
            max-width: 600px;
            margin-bottom: 30px;
            line-height: 1.6;
            color: #CCCCCC;
        }
        
        .completion-section .control-btn {
            pointer-events: auto;
            cursor: pointer;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .universe-title {
                font-size: 2.8rem;
            }
            
            .meditation-title {
                font-size: 2.5rem;
            }
            
            .guide-text {
                font-size: 1.3rem;
            }
            
            .planet-container {
                width: 250px;
                height: 250px;
            }
            
            .control-btn {
                min-width: 160px;
                padding: 10px 20px;
            }
            
            .meditation-guide-container {
                padding: 30px 20px;
            }
            
            .guide-section-title {
                font-size: 1.8rem;
            }
        }

        @media (max-width: 480px) {
            .universe-title {
                font-size: 2.2rem;
            }
            
            .universe-instruction {
                font-size: 1.2rem;
                padding: 0 20px;
            }
            
            .meditation-title {
                font-size: 2rem;
            }
            
            .planet-container {
                width: 200px;
                height: 200px;
            }
            
            .control-panel {
                gap: 10px;
            }
            
            .control-btn {
                min-width: 140px;
                font-size: 1rem;
            }
            
            .guide-text {
                font-size: 1.2rem;
            }
        }
    </style>
</head>
<body>
    <!-- å†¥æƒ³æ°›å›´èƒŒæ™¯ -->
    <div class="meditation-bg">
        <div class="bg-layer layer-universe"></div>
        <div class="bg-layer layer-forest"></div>
        <div class="bg-layer layer-sunlight"></div>
        <div class="bg-layer layer-stars"></div>
    </div>
    
    <!-- æ˜Ÿçƒåˆ›å»ºå®¹å™¨ -->
    <div class="planet-creation-container">
        <!-- å®‡å®™èšç„¦åŠ¨ç”»å®¹å™¨ -->
        <div class="universe-focus-container" id="universeFocusContainer">
            <div class="initial-universe">
                <div style="display: flex; flex-direction: column; align-items: center;">
                    <h1 class="universe-title" id="planetTitle">2026æ˜Ÿçƒ Â· å†¥æƒ³å¼•å¯¼</h1>
                    <p class="universe-instruction">
                        æ¯é¢—æ˜Ÿçƒä»£è¡¨ä½ <span class="highlight">ä¸€å¹´çš„ä¸“æ³¨ä¸æˆé•¿</span>ã€‚<br>
                        åœ¨å¼€å§‹è®°å½•ä¸“æ³¨æ—¶å…‰å‰,è¯·è·Ÿéšä¸“ä¸šå†¥æƒ³å¼•å¯¼,<br>
                        ä¸ºä½ çš„<span class="highlight" id="planetYear">2026</span>æ˜Ÿçƒè®¾å®šæ¸…æ™°çš„æ„¿æ™¯ä¸æ–¹å‘ã€‚
                    </p>
                    
                    <div class="planet-container">
                        <div class="new-planet" id="newPlanet">
                            <div class="planet-surface"></div>
                            <div class="planet-name" id="planetNameDisplay">2026</div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 30px;">
                        <button class="control-btn" id="startCreationBtn" style="background-color: var(--planet-1); color: var(--night-blue); font-weight: bold; padding: 15px 40px; font-size: 1.4rem;">
                            <i class="fas fa-seedling btn-icon"></i> å¼€å§‹å†¥æƒ³å¼•å¯¼
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- å†¥æƒ³ç©ºé—´ -->
        <div class="meditation-space" id="meditationSpace">
            <div class="breathing-circle" id="breathingCircle"></div>
            
            <div class="meditation-content">
                <h1 class="meditation-title" id="meditationTitle">2026æ˜Ÿçƒ Â· å†¥æƒ³å¼•å¯¼</h1>
                <div class="meditation-subtitle">ä¸“ä¸šå†¥æƒ³å¼•å¯¼ Â· æ¸©æš–å¥³å£° Â· è‡ªç„¶æ°›å›´</div>
                
                <div class="meditation-guide-container">
                    <!-- å†¥æƒ³å‡†å¤‡ä¸å¼€åœº -->
                    <div class="guide-section active" id="section1">
                        <h2 class="guide-section-title">å†¥æƒ³å‡†å¤‡ä¸å¼€åœº</h2>
                        <div class="guide-text-container" id="section1Text">
                            <!-- å†…å®¹å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                        </div>
                    </div>
                    
                    <!-- å‘¼å¸é”šå®šä¸èº«ä½“æ”¾æ¾ -->
                    <div class="guide-section" id="section2">
                        <h2 class="guide-section-title">å‘¼å¸é”šå®šä¸èº«ä½“æ”¾æ¾</h2>
                        <div class="guide-text-container" id="section2Text">
                            <!-- å†…å®¹å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                        </div>
                    </div>
                    
                    <!-- è‡ªç„¶æ„è±¡ä¸å†…å¿ƒå¹³é™ -->
                    <div class="guide-section" id="section3">
                        <h2 class="guide-section-title">è‡ªç„¶æ„è±¡ä¸å†…å¿ƒå¹³é™</h2>
                        <div class="guide-text-container" id="section3Text">
                            <!-- å†…å®¹å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                        </div>
                    </div>
                    
                    <!-- æ„¿æ™¯è®¾æƒ³çš„å¿ƒç†å‡†å¤‡ -->
                    <div class="guide-section" id="section4">
                        <h2 class="guide-section-title">æ„¿æ™¯è®¾æƒ³çš„å¿ƒç†å‡†å¤‡</h2>
                        <div class="guide-text-container" id="section4Text">
                            <!-- å†…å®¹å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                        </div>
                    </div>
                    
                    <!-- ç»“æŸä¸å›å½’ -->
                    <div class="guide-section" id="section5">
                        <h2 class="guide-section-title">ç»“æŸä¸å›å½’</h2>
                        <div class="guide-text-container" id="section5Text">
                            <!-- å†…å®¹å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                        </div>
                    </div>
                </div>
                
                <div class="guide-progress">
                    <div class="section-indicator">
                        <div class="section-dot active">1</div>
                        <div class="section-label">å‡†å¤‡</div>
                    </div>
                    <div class="section-indicator">
                        <div class="section-dot">2</div>
                        <div class="section-label">å‘¼å¸</div>
                    </div>
                    <div class="section-indicator">
                        <div class="section-dot">3</div>
                        <div class="section-label">æ„è±¡</div>
                    </div>
                    <div class="section-indicator">
                        <div class="section-dot">4</div>
                        <div class="section-label">æ„¿æ™¯</div>
                    </div>
                    <div class="section-indicator">
                        <div class="section-dot">5</div>
                        <div class="section-label">å›å½’</div>
                    </div>
                </div>
                
                <div class="control-panel">
                    <button class="control-btn" id="autoPlayBtn">
                        <i class="fas fa-robot btn-icon"></i> è‡ªåŠ¨å¼•å¯¼
                    </button>
                    <button class="control-btn" id="manualPlayBtn">
                        <i class="fas fa-hand-point-up btn-icon"></i> æ‰‹åŠ¨å¼•å¯¼
                    </button>
                    <button class="control-btn" id="prevSectionBtn" disabled>
                        <i class="fas fa-backward btn-icon"></i> ä¸Šä¸€é˜¶æ®µ
                    </button>
                    <button class="control-btn" id="nextSectionBtn">
                        <i class="fas fa-forward btn-icon"></i> ä¸‹ä¸€é˜¶æ®µ
                    </button>
                </div>
                
                <div class="completion-section" id="completionSection">
                    <h2 class="completion-title">å†¥æƒ³å¼•å¯¼å®Œæˆ</h2>
                    <p class="completion-text">
                        ä½ å·²ç»ä¸ºä½ çš„<span style="color: var(--planet-1); font-weight: bold;" id="completionYear">2026</span>æ˜Ÿçƒå®Œæˆäº†ä¸“ä¸šå†¥æƒ³å¼•å¯¼ã€‚<br>
                        ç°åœ¨,å¸¦ç€è¿™ä»½æ¸…æ™°ä¸å¹³é™,è¿›å…¥æ˜Ÿçƒå†…éƒ¨ç©ºé—´,<br>
                        å¼€å§‹è®°å½•ä½ çš„ä¸“æ³¨æ—¶å…‰,ç»˜åˆ¶ä½ çš„å¹´åº¦æ„¿æ™¯ã€‚
                    </p>
                    <button class="control-btn" id="enterPlanetBtn" style="background-color: var(--planet-1); color: var(--night-blue); font-weight: bold; padding: 15px 40px; font-size: 1.4rem;">
                        <i class="fas fa-door-open btn-icon"></i> è¿›å…¥2026æ˜Ÿçƒ
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- éŸ³é¢‘æ§åˆ¶ -->
    <div class="audio-controls">
        <button class="audio-btn active" id="musicToggleBtn">
            <i class="fas fa-music"></i>
        </button>
        <button class="audio-btn active" id="voiceToggleBtn">
            <i class="fas fa-microphone"></i>
        </button>
    </div>
    
    <!-- éŸ³é¢‘å…ƒç´  -->
    <audio id="backgroundMusic" loop>
        <source src="../assets/audio/background/meditation.mp3" type="audio/mpeg">
        <!-- å¤‡ç”¨CDNéŸ³ä¹ -->
        <source src="https://assets.mixkit.co/music/preview/mixkit-deep-ambient-space-1255.mp3" type="audio/mpeg">
    </audio>
    
    <!-- å¼•å¯¼è¯­éŸ³ -->
    <audio id="voiceSection1" src="../assets/audio/voice/section1.mp3"></audio>
    <audio id="voiceSection2" src="../assets/audio/voice/section2.mp3"></audio>
    <audio id="voiceSection3" src="../assets/audio/voice/section3.mp3"></audio>
    <audio id="voiceSection4" src="../assets/audio/voice/section4.mp3"></audio>
    <audio id="voiceSection5" src="../assets/audio/voice/section5.mp3"></audio>

    <script>
        // ç®€æ˜“LocalStorageç®¡ç†
        const STORAGE_PREFIX = 'vfh_';
        
        function getStorageData(key) {
            try {
                const data = localStorage.getItem(STORAGE_PREFIX + key);
                return data ? JSON.parse(data) : null;
            } catch (e) {
                console.error('Storage error:', e);
                return null;
            }
        }
        
        function setStorageData(key, value) {
            try {
                localStorage.setItem(STORAGE_PREFIX + key, JSON.stringify(value));
                return true;
            } catch (e) {
                console.error('Storage error:', e);
                return false;
            }
        }
        
        function getPlanet(year) {
            const planets = getStorageData('planets') || [];
            return planets.find(p => p.year === year);
        }
        
        function savePlanet(planet) {
            const planets = getStorageData('planets') || [];
            const index = planets.findIndex(p => p.year === planet.year);
            if (index >= 0) {
                planets[index] = planet;
            } else {
                planets.push(planet);
            }
            return setStorageData('planets', planets);
        }
        
        // æ˜¾ç¤ºé€šçŸ¥
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background-color: rgba(15, 25, 35, 0.95);
                padding: 15px 20px;
                border-radius: 10px;
                box-shadow: 0 5px 15px rgba(0,0,0,0.3);
                z-index: 10000;
                border-left: 5px solid var(--planet-1);
                animation: slideIn 0.5s ease, fadeOut 0.5s ease 2.5s forwards;
                max-width: 300px;
                font-family: 'Ma Shan Zheng', cursive;
                border: 1px solid rgba(78, 205, 196, 0.3);
            `;
            
            notification.innerHTML = `
                <div style="display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-info-circle" style="color: var(--planet-1);"></i>
                    <div style="color: white;">${message}</div>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 3000);
            
            if (!document.getElementById('notification-animations')) {
                const style = document.createElement('style');
                style.id = 'notification-animations';
                style.textContent = `
                    @keyframes slideIn {
                        from { transform: translateX(100%); opacity: 0; }
                        to { transform: translateX(0); opacity: 1; }
                    }
                    @keyframes fadeOut {
                        from { opacity: 1; }
                        to { opacity: 0; }
                    }
                `;
                document.head.appendChild(style);
            }
        }
        
        // å†¥æƒ³å¼•å¯¼å†…å®¹
        const meditationGuide = {
            sections: [
                {
                    id: 1,
                    title: "å†¥æƒ³å‡†å¤‡ä¸å¼€åœº",
                    bgLayer: "layer-universe",
                    lines: [
                        { text: "è¯·æ‰¾åˆ°ä¸€ä¸ªèˆ’é€‚çš„å§¿åŠ¿åä¸‹ã€‚", pause: 4000 },
                        { text: "å¯ä»¥æ˜¯ç›˜å,æˆ–ååœ¨æ¤…å­ä¸Šã€‚", pause: 2000 },
                        { text: "ç¡®ä¿è„ŠæŸ±è‡ªç„¶æŒºç›´,", pause: 2000 },
                        { text: "åŒè‚©ä¸‹æ²‰,", pause: 2000 },
                        { text: "åŒæ‰‹è½»æ”¾äºè†ç›–æˆ–å¤§è…¿ä¸Šã€‚", pause: 6000, isPause: true },
                        { text: "è½»è½»é—­ä¸Šçœ¼ç›,", pause: 3000 },
                        { text: "è®©èº«ä½“çš„é‡é‡,", pause: 2000 },
                        { text: "å®Œå…¨ç”±åœ°é¢æ”¯æ’‘ã€‚", pause: 5000, isPause: true },
                        { text: "ç°åœ¨,", pause: 2000 },
                        { text: "å°†æ³¨æ„åŠ›è½¬å‘å‘¼å¸ã€‚", pause: 2000 },
                        { text: "æ— éœ€åˆ»æ„è°ƒæ•´,", pause: 2000 },
                        { text: "åªéœ€è§‚å¯Ÿæ°”æ¯çš„è‡ªç„¶æµåŠ¨ã€‚", pause: 4000, isPause: true },
                        { text: "å¸æ°”æ—¶,", pause: 2000 },
                        { text: "æ„Ÿå—ç©ºæ°”é€šè¿‡é¼»è…”çš„æ¸…å‡‰æ„Ÿã€‚", pause: 3000, isPause: true },
                        { text: "å‘¼æ°”æ—¶,", pause: 2000 },
                        { text: "ä½“ä¼šæ°”æ¯ç¦»å¼€èº«ä½“çš„æ¸©çƒ­æ„Ÿã€‚", pause: 5000, isPause: true },
                        { text: "å…è®¸è‡ªå·±åœ¨è¿™ä¸€åˆ»,", pause: 2000 },
                        { text: "æ”¾ä¸‹æ‰€æœ‰æ‚å¿µ,", pause: 2000 },
                        { text: "å¦‚åŒå°†æ²‰é‡çš„è¡Œæ,", pause: 2000 },
                        { text: "æš‚æ—¶æç½®åœ¨ä¸€æ—ã€‚", pause: 6000, isPause: true },
                        { text: "è¿™é‡Œæ²¡æœ‰è¯„åˆ¤,", pause: 2000 },
                        { text: "æ²¡æœ‰åŒ†å¿™,", pause: 2000 },
                        { text: "åªæœ‰ä½ ,", pause: 2000 },
                        { text: "ä¸è‡ªå·±çš„ç›¸å¤„ã€‚", pause: 8000, isPause: true, isHighlight: true }
                    ],
                    estimatedDuration: 90000
                },
                {
                    id: 2,
                    title: "å‘¼å¸é”šå®šä¸èº«ä½“æ”¾æ¾",
                    bgLayer: "layer-forest",
                    lines: [
                        { text: "æ¥ä¸‹æ¥,", pause: 2000 },
                        { text: "æˆ‘ä»¬å°†é€šè¿‡å‘¼å¸,", pause: 2000 },
                        { text: "è®©èº«å¿ƒé€æ¸å¹³é™ã€‚", pause: 4000, isPause: true },
                        { text: "å¸æ°”æ—¶,", pause: 2000 },
                        { text: "æƒ³è±¡å°†æ¸…æ–°çš„èƒ½é‡å¸å…¥ä½“å†…,", pause: 2000 },
                        { text: "æ»‹å…»æ¯ä¸€ä¸ªç»†èƒã€‚", pause: 4000, isPause: true },
                        { text: "å‘¼æ°”æ—¶,", pause: 2000 },
                        { text: "å°†å‹åŠ›ä¸æ‚å¿µ,", pause: 2000 },
                        { text: "ç¼“ç¼“æ’å‡º,", pause: 2000 },
                        { text: "å¦‚åŒæµ·æµªå¸¦èµ°æ²™ç²’ã€‚", pause: 6000, isPause: true },
                        { text: "ç°åœ¨,", pause: 2000 },
                        { text: "å°†æ„è¯†ä»å¤´é¡¶å¼€å§‹,", pause: 2000 },
                        { text: "å‘ä¸‹æ‰«æã€‚", pause: 4000, isPause: true },
                        { text: "æ”¾æ¾å¤´çš®â€¦â€¦", pause: 5000, isPause: true },
                        { text: "èˆ’å±•çœ‰å¿ƒâ€¦â€¦", pause: 5000, isPause: true },
                        { text: "é‡Šæ”¾è„¸é¢Šçš„ç´§ç»·æ„Ÿâ€¦â€¦", pause: 6000, isPause: true },
                        { text: "è®©è‚©è†€è‡ªç„¶ä¸‹å‚,", pause: 3000 },
                        { text: "æ‰‹è‡‚é€æ¸æŸ”è½¯,", pause: 3000 },
                        { text: "æ‰‹æŒ‡,", pause: 2000 },
                        { text: "å¾®å¾®å‘æš–ã€‚", pause: 7000, isPause: true },
                        { text: "æ„Ÿå—èƒ¸è…”çš„å¼€é˜”,", pause: 3000 },
                        { text: "è…¹éƒ¨çš„èµ·ä¼ã€‚", pause: 6000, isPause: true },
                        { text: "åŒè…¿,", pause: 2000 },
                        { text: "åŒè„š,", pause: 2000 },
                        { text: "å®Œå…¨æ²‰å‘åœ°é¢ã€‚", pause: 8000, isPause: true },
                        { text: "å¦‚æœæ€ç»ªé£˜èµ°,", pause: 2000 },
                        { text: "åªéœ€æ¸©æŸ”åœ°,", pause: 2000 },
                        { text: "å°†æ³¨æ„åŠ›å¸¦å›å‘¼å¸ã€‚", pause: 4000, isPause: true },
                        { text: "å¦‚åŒä¸€ç‰‡äº‘,", pause: 2000 },
                        { text: "è½»è½»é£˜è¿‡ã€‚", pause: 2000 },
                        { text: "ä¸æŠ—æ‹’,", pause: 2000 },
                        { text: "ä¹Ÿä¸è¿½é€ã€‚", pause: 8000, isPause: true, isHighlight: true }
                    ],
                    estimatedDuration: 100000
                },
                {
                    id: 3,
                    title: "è‡ªç„¶æ„è±¡ä¸å†…å¿ƒå¹³é™",
                    bgLayer: "layer-sunlight",
                    lines: [
                        { text: "æƒ³è±¡è‡ªå·±,", pause: 2000 },
                        { text: "æ¼«æ­¥åœ¨ä¸€ç‰‡å®é™çš„æ£®æ—ä¸­ã€‚", pause: 5000, isPause: true },
                        { text: "é˜³å…‰,", pause: 2000 },
                        { text: "é€è¿‡æ ‘å¶,", pause: 2000 },
                        { text: "æ´’ä¸‹æ–‘é©³çš„å…‰ç‚¹ã€‚", pause: 6000, isPause: true },
                        { text: "å¾®é£,", pause: 2000 },
                        { text: "è½»æ‹‚è„¸é¢Š,", pause: 2000 },
                        { text: "å¸¦æ¥é’è‰ä¸æ³¥åœŸçš„èŠ¬èŠ³ã€‚", pause: 7000, isPause: true },
                        { text: "è¿œå¤„,", pause: 2000 },
                        { text: "æºªæµæ½ºæ½º,", pause: 2000 },
                        { text: "é¸Ÿé¸£æ¸…è„†ã€‚", pause: 6000, isPause: true },
                        { text: "è‡ªç„¶çš„å£°éŸ³,", pause: 2000 },
                        { text: "å°†ä½ åŒ…è£¹åœ¨", pause: 2000 },
                        { text: "å®‰å…¨è€Œæ”¾æ¾çš„æ°›å›´ä¸­ã€‚", pause: 8000, isPause: true },
                        { text: "æ„Ÿå—åŒè„š,", pause: 2000 },
                        { text: "ä¸å¤§åœ°ç´§å¯†è¿æ¥ã€‚", pause: 5000, isPause: true },
                        { text: "å¦‚åŒä¸€æ£µå¤§æ ‘,", pause: 2000 },
                        { text: "æ ¹ç³»æ·±å…¥åœŸå£¤,", pause: 2000 },
                        { text: "ç¨³å›º,", pause: 2000 },
                        { text: "è€Œå®‰å®ã€‚", pause: 8000, isPause: true, isHighlight: true },
                        { text: "æ¯ä¸€æ¬¡å¸æ°”,", pause: 2000 },
                        { text: "å¸æ”¶æ£®æ—çš„ç”Ÿæœºã€‚", pause: 4000, isPause: true },
                        { text: "æ¯ä¸€æ¬¡å‘¼æ°”,", pause: 2000 },
                        { text: "é‡Šæ”¾å†…å¿ƒçš„çº·æ‰°ã€‚", pause: 6000, isPause: true },
                        { text: "åœ¨è¿™é‡Œ,", pause: 2000 },
                        { text: "ä½ æ— éœ€åŠªåŠ›ã€‚", pause: 2000 },
                        { text: "åªéœ€å­˜åœ¨,", pause: 2000 },
                        { text: "ä¸æ„ŸçŸ¥ã€‚", pause: 10000, isPause: true, isHighlight: true }
                    ],
                    estimatedDuration: 90000
                },
                {
                    id: 4,
                    title: "æ„¿æ™¯è®¾æƒ³çš„å¿ƒç†å‡†å¤‡",
                    bgLayer: "layer-stars",
                    lines: [
                        { text: "åœ¨è¿™ä»½å¹³é™ä¸ä¸“æ³¨ä¸­,", pause: 3000 },
                        { text: "è¯·å°†æ³¨æ„åŠ›,", pause: 2000 },
                        { text: "è½»è½»è½¬å‘å†…å¿ƒã€‚", pause: 5000, isPause: true },
                        { text: "é—®é—®è‡ªå·±:", pause: 2000 },
                        { text: "å¦‚æœæ²¡æœ‰é™åˆ¶,", pause: 2000 },
                        { text: "æˆ‘æœ€æƒ³åˆ›é€ çš„æœªæ¥,", pause: 2000 },
                        { text: "æ˜¯ä»€ä¹ˆ?", pause: 8000, isPause: true, isHighlight: true },
                        { text: "å“ªäº›ç”»é¢,", pause: 2000 },
                        { text: "è®©æˆ‘æ„Ÿåˆ°å–œæ‚¦?", pause: 3000 },
                        { text: "å“ªäº›å¿µå¤´,", pause: 2000 },
                        { text: "å¸¦æ¥åŠ¨åŠ›?", pause: 8000, isPause: true, isHighlight: true },
                        { text: "æ— éœ€å¯»æ‰¾ç­”æ¡ˆã€‚", pause: 2000 },
                        { text: "æ— éœ€ç”¨åŠ›æ€è€ƒã€‚", pause: 5000, isPause: true },
                        { text: "åªæ˜¯å…è®¸è¿™äº›æ„¿æ™¯,", pause: 2000 },
                        { text: "å¦‚ç§å­ä¸€èˆ¬,", pause: 2000 },
                        { text: "åœ¨å¿ƒåº•,", pause: 2000 },
                        { text: "æ…¢æ…¢èŒèŠ½ã€‚", pause: 8000, isPause: true, isHighlight: true },
                        { text: "æƒ³è±¡å®ƒä»¬,", pause: 2000 },
                        { text: "å¦‚åŒæ˜Ÿå…‰,", pause: 2000 },
                        { text: "åœ¨å†…åœ¨çš„å¤œç©ºä¸­,", pause: 2000 },
                        { text: "é€æ¸æ˜äº®ã€‚", pause: 10000, isPause: true, isHighlight: true },
                        { text: "åœ¨å¿ƒä¸­è½»è½»å‘Šè¯‰è‡ªå·±:", pause: 3000 },
                        { text: "æˆ‘å…è®¸è¿™äº›å¯èƒ½æ€§å­˜åœ¨ã€‚", pause: 4000 },
                        { text: "æˆ‘æ„¿æ„,", pause: 2000 },
                        { text: "ä»¥å¼€æ”¾çš„å¿ƒ,", pause: 2000 },
                        { text: "è¿æ¥å®ƒä»¬ã€‚", pause: 10000, isPause: true, isHighlight: true }
                    ],
                    estimatedDuration: 80000
                },
                {
                    id: 5,
                    title: "ç»“æŸä¸å›å½’",
                    bgLayer: "layer-universe",
                    lines: [
                        { text: "ç°åœ¨,", pause: 2000 },
                        { text: "æ…¢æ…¢å°†æ³¨æ„åŠ›,", pause: 2000 },
                        { text: "å¸¦å›å‘¼å¸ã€‚", pause: 4000, isPause: true },
                        { text: "æ„Ÿå—èº«ä½“,", pause: 2000 },
                        { text: "ä¸åº§ä½çš„æ¥è§¦ã€‚", pause: 4000, isPause: true },
                        { text: "è½»è½»æ´»åŠ¨æ‰‹æŒ‡,", pause: 2000 },
                        { text: "æ´»åŠ¨è„šè¶¾ã€‚", pause: 4000, isPause: true },
                        { text: "æ“çƒ­æŒå¿ƒ,", pause: 2000 },
                        { text: "å°†æ¸©æš–,", pause: 2000 },
                        { text: "æ•·åœ¨åŒçœ¼ä¸Šã€‚", pause: 5000, isPause: true },
                        { text: "å½“ä½ å‡†å¤‡å¥½æ—¶,", pause: 2000 },
                        { text: "ç¼“ç¼“çå¼€çœ¼ç›ã€‚", pause: 4000, isPause: true },
                        { text: "é€‚åº”å‘¨å›´çš„å…‰çº¿ã€‚", pause: 4000, isPause: true },
                        { text: "å¸¦ç€è¿™ä»½å®é™ä¸æ¸…æ™°,", pause: 3000 },
                        { text: "è¿›å…¥æ¥ä¸‹æ¥çš„æ„¿æ™¯æ¿åˆ›ä½œã€‚", pause: 6000, isPause: true },
                        { text: "è¯·è®°ä½:", pause: 2000 },
                        { text: "è¿™ä»½å¹³é™çš„åŠ›é‡,", pause: 2000 },
                        { text: "å§‹ç»ˆåœ¨ä½ ä¹‹å†…,", pause: 2000 },
                        { text: "éšæ—¶,", pause: 2000 },
                        { text: "å¯ä»¥è¢«ä½ è°ƒç”¨ã€‚", pause: 10000, isPause: true, isHighlight: true }
                    ],
                    estimatedDuration: 60000
                }
            ],
            currentSection: 0,
            currentLine: 0,
            isAutoPlay: true,
            isMusicPlaying: true,
            isVoicePlaying: true,
            lineTimeout: null,
            sectionTimeout: null,
            isMeditationActive: false
        };

        // å½“å‰æ˜Ÿçƒä¿¡æ¯
        let currentPlanet = null;

        // DOMå…ƒç´ 
        const universeBg = document.querySelector('.meditation-bg');
        const universeFocusContainer = document.getElementById('universeFocusContainer');
        const newPlanet = document.getElementById('newPlanet');
        const startCreationBtn = document.getElementById('startCreationBtn');
        const meditationSpace = document.getElementById('meditationSpace');
        const breathingCircle = document.getElementById('breathingCircle');
        const autoPlayBtn = document.getElementById('autoPlayBtn');
        const manualPlayBtn = document.getElementById('manualPlayBtn');
        const prevSectionBtn = document.getElementById('prevSectionBtn');
        const nextSectionBtn = document.getElementById('nextSectionBtn');
        const musicToggleBtn = document.getElementById('musicToggleBtn');
        const voiceToggleBtn = document.getElementById('voiceToggleBtn');
        const completionSection = document.getElementById('completionSection');
        const enterPlanetBtn = document.getElementById('enterPlanetBtn');
        const sectionDots = document.querySelectorAll('.section-dot');
        const sectionIndicators = document.querySelectorAll('.section-indicator');
        
        // éŸ³é¢‘å…ƒç´ 
        const backgroundMusic = document.getElementById('backgroundMusic');
        const voiceAudios = {
            1: document.getElementById('voiceSection1'),
            2: document.getElementById('voiceSection2'),
            3: document.getElementById('voiceSection3'),
            4: document.getElementById('voiceSection4'),
            5: document.getElementById('voiceSection5')
        };
        
        // è®¾ç½®è¯­éŸ³éŸ³é‡
        Object.values(voiceAudios).forEach(audio => {
            if (audio) audio.volume = 0.7;
        });

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initApp();
            setupEventListeners();
            populateGuideSections();
        });

        function initApp() {
            // ä»URLè·å–å¹´ä»½å‚æ•°
            const urlParams = new URLSearchParams(window.location.search);
            const year = urlParams.get('year') || new Date().getFullYear();
            
            // è·å–æˆ–åˆ›å»ºæ˜Ÿçƒ
            currentPlanet = getPlanet(year);
            
            // æ›´æ–°é¡µé¢æ˜¾ç¤º
            updatePlanetDisplay(year);
            
            // è®¾ç½®èƒŒæ™¯éŸ³ä¹éŸ³é‡
            backgroundMusic.volume = 0.3;
            
            // é»˜è®¤è‡ªåŠ¨æ’­æ”¾æ¨¡å¼
            setAutoPlayMode(true);
        }

        function updatePlanetDisplay(year) {
            const elements = [
                document.getElementById('planetTitle'),
                document.getElementById('planetYear'),
                document.getElementById('planetNameDisplay'),
                document.getElementById('meditationTitle'),
                document.getElementById('completionYear')
            ];
            
            elements.forEach(el => {
                if (el) {
                    if (el.id === 'planetTitle' || el.id === 'meditationTitle') {
                        el.textContent = `${year}æ˜Ÿçƒ Â· å†¥æƒ³å¼•å¯¼`;
                    } else {
                        el.textContent = year;
                    }
                }
            });
        }

        function populateGuideSections() {
            meditationGuide.sections.forEach(section => {
                const container = document.getElementById(`section${section.id}Text`);
                if (!container) return;
                
                container.innerHTML = '';
                
                section.lines.forEach((line, index) => {
                    const lineElement = document.createElement('div');
                    lineElement.className = 'guide-line';
                    
                    if (line.isPause) {
                        lineElement.classList.add('pause-line');
                    }
                    
                    if (line.isHighlight) {
                        lineElement.classList.add('highlight');
                    }
                    
                    lineElement.textContent = line.text;
                    lineElement.style.animationDelay = `${index * 0.1}s`;
                    
                    if (line.isPause && line.pause >= 5000) {
                        const pauseIndicator = document.createElement('span');
                        pauseIndicator.className = 'pause-indicator';
                        lineElement.appendChild(pauseIndicator);
                    }
                    
                    container.appendChild(lineElement);
                });
            });
        }

        function showCompletionSection() {
            console.log('æ˜¾ç¤ºå®Œæˆç•Œé¢');
            
            // éšè—æ‰€æœ‰å¼•å¯¼é˜¶æ®µ
            document.querySelectorAll('.guide-section').forEach(section => {
                section.classList.remove('active');
                section.style.display = 'none';
            });
            
            // åœæ­¢æ‰€æœ‰éŸ³é¢‘
            Object.values(voiceAudios).forEach(audio => {
                if (audio) {
                    audio.pause();
                    audio.currentTime = 0;
                }
            });
            
            // åœæ­¢æ‰€æœ‰å®šæ—¶å™¨
            clearTimeout(meditationGuide.lineTimeout);
            clearTimeout(meditationGuide.sectionTimeout);
            
            // æ˜¾ç¤ºå®Œæˆç•Œé¢
            completionSection.style.display = 'flex';
            completionSection.style.opacity = '0';
            completionSection.style.pointerEvents = 'auto';
            
            setTimeout(() => {
                completionSection.style.transition = 'opacity 1s ease';
                completionSection.style.opacity = '1';
            }, 100);
            
            // æ›´æ–°æŒ‰é’®æ–‡æœ¬
            const urlParams = new URLSearchParams(window.location.search);
            const year = urlParams.get('year') || new Date().getFullYear();
            
            const enterBtn = document.getElementById('enterPlanetBtn');
            if (enterBtn) {
                enterBtn.innerHTML = `<i class="fas fa-door-open btn-icon"></i> è¿›å…¥${year}æ˜Ÿçƒ`;
                enterBtn.disabled = false;
                enterBtn.style.pointerEvents = 'auto';
                enterBtn.style.cursor = 'pointer';
            }
            
            showNotification('âœ¨ å†¥æƒ³å¼•å¯¼å®Œæˆ! ç°åœ¨å¯ä»¥è¿›å…¥æ˜Ÿçƒå¼€å§‹ä½ çš„æ„¿æ™¯ä¹‹æ—…ã€‚');
        }

        function enterPlanet() {
            const urlParams = new URLSearchParams(window.location.search);
            const year = urlParams.get('year') || new Date().getFullYear();
            
            // ä¿å­˜å†¥æƒ³å®ŒæˆçŠ¶æ€
            const planets = getStorageData('planets') || [];
            const planetIndex = planets.findIndex(p => p.year === parseInt(year));
            
            if (planetIndex !== -1) {
                planets[planetIndex].meditationCompleted = true;
                planets[planetIndex].meditationCompletedAt = new Date().toISOString();
                setStorageData('planets', planets);
            }
            
            showNotification('ğŸŒ± æ­£åœ¨è¿›å…¥æ„¿æœ›ç¢ç‰‡é¡µé¢...');
            
            setTimeout(() => {
                window.location.href = `dreamfragment.html?year=${year}`;
            }, 1000);
        }

        function setupEventListeners() {
            startCreationBtn.addEventListener('click', startPlanetCreation);
            autoPlayBtn.addEventListener('click', () => setAutoPlayMode(true));
            manualPlayBtn.addEventListener('click', () => setAutoPlayMode(false));
            prevSectionBtn.addEventListener('click', prevSection);
            nextSectionBtn.addEventListener('click', nextSection);
            musicToggleBtn.addEventListener('click', toggleMusic);
            voiceToggleBtn.addEventListener('click', toggleVoice);
            enterPlanetBtn.addEventListener('click', enterPlanet);
            
            sectionIndicators.forEach((indicator, index) => {
                indicator.addEventListener('click', () => {
                    if (index <= meditationGuide.currentSection) {
                        goToSection(index);
                    }
                });
            });
            
            document.addEventListener('keydown', function(e) {
                if (!meditationGuide.isMeditationActive) return;
                
                if (e.key === ' ') {
                    e.preventDefault();
                    setAutoPlayMode(!meditationGuide.isAutoPlay);
                }
                
                if (e.key === 'ArrowRight') {
                    nextSection();
                }
                
                if (e.key === 'ArrowLeft') {
                    prevSection();
                }
                
                if (e.key === 'm' || e.key === 'M') {
                    toggleMusic();
                }
                
                if (e.key === 'v' || e.key === 'V') {
                    toggleVoice();
                }
            });
        }

        function startPlanetCreation() {
            startCreationBtn.disabled = true;
            startCreationBtn.innerHTML = '<i class="fas fa-spinner fa-spin btn-icon"></i> å‡†å¤‡ä¸­...';
            
            // æ’­æ”¾èƒŒæ™¯éŸ³ä¹
            backgroundMusic.play().catch(e => {
                console.log('éŸ³ä¹è‡ªåŠ¨æ’­æ”¾è¢«é˜»æ­¢:', e);
            });
            
            universeFocusContainer.style.transform = 'scale(20)';
            universeFocusContainer.style.opacity = '0.8';
            
            newPlanet.style.transform = 'scale(1.5)';
            newPlanet.style.boxShadow = 'inset 0 0 50px rgba(255, 255, 255, 0.3), 0 0 120px rgba(78, 205, 196, 0.9)';
            
            setTimeout(() => {
                meditationSpace.style.display = 'flex';
                universeFocusContainer.style.display = 'none';
                meditationGuide.isMeditationActive = true;
                
                breathingCircle.style.opacity = '0.5';
                
                startMeditationSection(0);
                
                showNotification('ğŸ§˜ å¼€å§‹å†¥æƒ³å¼•å¯¼ Â· è¯·è·Ÿéšå¼•å¯¼æ”¾æ¾èº«å¿ƒ...');
            }, 3000);
        }

        function startMeditationSection(sectionIndex) {
            clearTimeout(meditationGuide.lineTimeout);
            clearTimeout(meditationGuide.sectionTimeout);
            
            meditationGuide.currentSection = sectionIndex;
            meditationGuide.currentLine = 0;
            
            updateSectionDisplay();
            updateProgressIndicators();
            updateControlButtons();
            updateBackgroundLayer();
            
            // æ’­æ”¾è¯¥é˜¶æ®µçš„è¯­éŸ³
            playSectionVoice(sectionIndex + 1);
            
            if (meditationGuide.isAutoPlay) {
                startAutoPlayLines();
            } else {
                showAllLines();
            }
        }
        
        // æ’­æ”¾é˜¶æ®µè¯­éŸ³
        function playSectionVoice(sectionId) {
            // åœæ­¢æ‰€æœ‰è¯­éŸ³
            Object.values(voiceAudios).forEach(audio => {
                if (audio) {
                    audio.pause();
                    audio.currentTime = 0;
                }
            });
            
            // æ’­æ”¾å½“å‰é˜¶æ®µçš„è¯­éŸ³
            const voiceAudio = voiceAudios[sectionId];
            if (voiceAudio && meditationGuide.isVoicePlaying) {
                voiceAudio.play().catch(e => {
                    console.log('è¯­éŸ³æ’­æ”¾å¤±è´¥æˆ–æ–‡ä»¶ä¸å­˜åœ¨:', e);
                });
                
                // ç›‘å¬è¯­éŸ³æ’­æ”¾ç»“æŸäº‹ä»¶
                voiceAudio.onended = function() {
                    console.log(`Section ${sectionId} voice ended`);
                    // è¯­éŸ³æ’­æ”¾å®Œæ¯•,å¦‚æœæ˜¯è‡ªåŠ¨æ¨¡å¼ä¸”è¿˜æœ‰ä¸‹ä¸€é˜¶æ®µ,åˆ™è‡ªåŠ¨åˆ‡æ¢
                    if (meditationGuide.isAutoPlay) {
                        if (meditationGuide.currentSection < meditationGuide.sections.length - 1) {
                            // ç­‰å¾…3ç§’åè‡ªåŠ¨è¿›å…¥ä¸‹ä¸€é˜¶æ®µ
                            meditationGuide.sectionTimeout = setTimeout(() => {
                                nextSection();
                            }, 3000);
                        } else {
                            // æœ€åä¸€ä¸ªé˜¶æ®µ,æ˜¾ç¤ºå®Œæˆç•Œé¢
                            meditationGuide.sectionTimeout = setTimeout(() => {
                                showCompletionSection();
                            }, 3000);
                        }
                    }
                };
            }
        }

        function startAutoPlayLines() {
            const section = meditationGuide.sections[meditationGuide.currentSection];
            const voiceAudio = voiceAudios[section.id];
            
            // å¦‚æœæœ‰è¯­éŸ³éŸ³é¢‘ä¸”æ­£åœ¨æ’­æ”¾,åˆ™è·³è¿‡æ–‡å­—é€è¡Œæ˜¾ç¤º,ç›´æ¥æ˜¾ç¤ºå…¨éƒ¨
            if (voiceAudio && meditationGuide.isVoicePlaying && !voiceAudio.paused) {
                showAllLines();
                // è¯­éŸ³ä¼šè‡ªåŠ¨å¤„ç†é˜¶æ®µåˆ‡æ¢ (åœ¨playSectionVoiceçš„onendedä¸­)
                return;
            }
            
            // æ²¡æœ‰è¯­éŸ³æˆ–è¯­éŸ³æœªæ’­æ”¾,ä½¿ç”¨æ–‡å­—é€è¡Œæ˜¾ç¤º
            showLine(meditationGuide.currentLine);
            
            const line = section.lines[meditationGuide.currentLine];
            meditationGuide.lineTimeout = setTimeout(() => {
                meditationGuide.currentLine++;
                
                if (meditationGuide.currentLine < section.lines.length) {
                    startAutoPlayLines();
                } else {
                    // å½“å‰é˜¶æ®µçš„æ–‡å­—æ’­æ”¾å®Œæ¯•
                    if (meditationGuide.isAutoPlay && meditationGuide.currentSection < meditationGuide.sections.length - 1) {
                        meditationGuide.sectionTimeout = setTimeout(() => {
                            nextSection();
                        }, 3000);
                    } else if (meditationGuide.currentSection === meditationGuide.sections.length - 1) {
                        meditationGuide.sectionTimeout = setTimeout(() => {
                            showCompletionSection();
                        }, 3000);
                    }
                }
            }, line.pause || 2000);
        }

        function showLine(lineIndex) {
            const section = meditationGuide.sections[meditationGuide.currentSection];
            const container = document.getElementById(`section${section.id}Text`);
            
            if (!container || lineIndex >= section.lines.length) return;
            
            const lines = container.querySelectorAll('.guide-line');
            lines.forEach(line => {
                line.style.opacity = '0.3';
            });
            
            for (let i = 0; i <= lineIndex; i++) {
                if (lines[i]) {
                    lines[i].style.opacity = '1';
                    lines[i].style.transform = 'translateY(0)';
                }
            }
            
            if (lines[lineIndex]) {
                lines[lineIndex].scrollIntoView({
                    behavior: 'smooth',
                    block: 'center'
                });
            }
        }

        function showAllLines() {
            const section = meditationGuide.sections[meditationGuide.currentSection];
            const container = document.getElementById(`section${section.id}Text`);
            if (!container) return;
            
            const lines = container.querySelectorAll('.guide-line');
            lines.forEach(line => {
                line.style.opacity = '1';
                line.style.transform = 'translateY(0)';
            });
        }

        function updateSectionDisplay() {
            document.querySelectorAll('.guide-section').forEach(section => {
                section.classList.remove('active');
            });
            
            const currentSection = meditationGuide.sections[meditationGuide.currentSection];
            const sectionElement = document.getElementById(`section${currentSection.id}`);
            if (sectionElement) {
                sectionElement.classList.add('active');
                
                const textContainer = sectionElement.querySelector('.guide-text-container');
                if (textContainer) {
                    textContainer.scrollTop = 0;
                }
            }
        }

        function updateProgressIndicators() {
            sectionDots.forEach((dot, index) => {
                dot.classList.remove('active', 'completed');
                
                if (index === meditationGuide.currentSection) {
                    dot.classList.add('active');
                } else if (index < meditationGuide.currentSection) {
                    dot.classList.add('completed');
                }
            });
        }

        function updateControlButtons() {
            prevSectionBtn.disabled = meditationGuide.currentSection === 0;
            
            const isLastSection = meditationGuide.currentSection === meditationGuide.sections.length - 1;
            
            if (isLastSection) {
                // åœ¨æœ€åä¸€ä¸ªé˜¶æ®µ,å°†"ä¸‹ä¸€é˜¶æ®µ"æŒ‰é’®æ”¹ä¸º"å®Œæˆå†¥æƒ³"
                nextSectionBtn.disabled = false;
                nextSectionBtn.innerHTML = '<i class="fas fa-check-circle btn-icon"></i> å®Œæˆå†¥æƒ³';
                nextSectionBtn.style.backgroundColor = 'var(--planet-1)';
                nextSectionBtn.style.color = 'var(--night-blue)';
                nextSectionBtn.style.fontWeight = 'bold';
                
                // ç‚¹å‡»åæ˜¾ç¤ºå®Œæˆç•Œé¢
                nextSectionBtn.onclick = function() {
                    showCompletionSection();
                };
            } else {
                nextSectionBtn.disabled = false;
                nextSectionBtn.innerHTML = '<i class="fas fa-forward btn-icon"></i> ä¸‹ä¸€é˜¶æ®µ';
                nextSectionBtn.style.backgroundColor = '';
                nextSectionBtn.style.color = '';
                nextSectionBtn.style.fontWeight = '';
                nextSectionBtn.onclick = null;
            }
        }

        function updateBackgroundLayer() {
            const section = meditationGuide.sections[meditationGuide.currentSection];
            
            document.querySelectorAll('.bg-layer').forEach(layer => {
                layer.style.opacity = '0';
            });
            
            const targetLayer = document.querySelector(`.${section.bgLayer}`);
            if (targetLayer) {
                targetLayer.style.opacity = '1';
            }
            
            if (section.id === 2 || section.id === 3) {
                breathingCircle.style.opacity = '0.7';
            } else {
                breathingCircle.style.opacity = '0.3';
            }
        }

        function setAutoPlayMode(isAuto) {
            meditationGuide.isAutoPlay = isAuto;
            
            if (isAuto) {
                autoPlayBtn.classList.add('active');
                manualPlayBtn.classList.remove('active');
                
                clearTimeout(meditationGuide.lineTimeout);
                clearTimeout(meditationGuide.sectionTimeout);
                
                startAutoPlayLines();
                
                showNotification('ğŸ“» å·²åˆ‡æ¢ä¸ºè‡ªåŠ¨å¼•å¯¼æ¨¡å¼');
            } else {
                autoPlayBtn.classList.remove('active');
                manualPlayBtn.classList.add('active');
                
                clearTimeout(meditationGuide.lineTimeout);
                clearTimeout(meditationGuide.sectionTimeout);
                
                showAllLines();
                
                showNotification('ğŸ‘† å·²åˆ‡æ¢ä¸ºæ‰‹åŠ¨å¼•å¯¼æ¨¡å¼');
            }
        }

        function nextSection() {
            if (meditationGuide.currentSection < meditationGuide.sections.length - 1) {
                startMeditationSection(meditationGuide.currentSection + 1);
            }
        }

        function prevSection() {
            if (meditationGuide.currentSection > 0) {
                startMeditationSection(meditationGuide.currentSection - 1);
            }
        }

        function goToSection(sectionIndex) {
            if (sectionIndex >= 0 && sectionIndex < meditationGuide.sections.length) {
                startMeditationSection(sectionIndex);
            }
        }

        function toggleMusic() {
            if (meditationGuide.isMusicPlaying) {
                backgroundMusic.pause();
                musicToggleBtn.classList.remove('active');
                musicToggleBtn.style.color = '#CCCCCC';
                musicToggleBtn.style.borderColor = '#CCCCCC';
                showNotification('ğŸ”‡ èƒŒæ™¯éŸ³ä¹å·²å…³é—­');
            } else {
                backgroundMusic.play().catch(e => {
                    console.log('éŸ³ä¹æ’­æ”¾å¤±è´¥:', e);
                });
                musicToggleBtn.classList.add('active');
                musicToggleBtn.style.color = 'var(--planet-1)';
                musicToggleBtn.style.borderColor = 'var(--planet-1)';
                showNotification('ğŸ”Š èƒŒæ™¯éŸ³ä¹å·²å¼€å¯');
            }
            meditationGuide.isMusicPlaying = !meditationGuide.isMusicPlaying;
        }

        function toggleVoice() {
            if (meditationGuide.isVoicePlaying) {
                // åœæ­¢æ‰€æœ‰è¯­éŸ³
                Object.values(voiceAudios).forEach(audio => {
                    if (audio) {
                        audio.pause();
                        audio.currentTime = 0;
                    }
                });
                
                voiceToggleBtn.classList.remove('active');
                voiceToggleBtn.style.color = '#CCCCCC';
                voiceToggleBtn.style.borderColor = '#CCCCCC';
                showNotification('ğŸ”‡ å¼•å¯¼è¯­éŸ³å·²å…³é—­');
                
                meditationGuide.isVoicePlaying = false;
                
                // å¦‚æœåœ¨è‡ªåŠ¨æ¨¡å¼,åˆ‡æ¢ä¸ºæ–‡å­—å¼•å¯¼
                if (meditationGuide.isAutoPlay) {
                    clearTimeout(meditationGuide.lineTimeout);
                    startAutoPlayLines();
                }
            } else {
                voiceToggleBtn.classList.add('active');
                voiceToggleBtn.style.color = 'var(--planet-1)';
                voiceToggleBtn.style.borderColor = 'var(--planet-1)';
                showNotification('ğŸ”Š å¼•å¯¼è¯­éŸ³å·²å¼€å¯');
                
                meditationGuide.isVoicePlaying = true;
                
                // æ’­æ”¾å½“å‰é˜¶æ®µçš„è¯­éŸ³
                if (meditationGuide.isMeditationActive) {
                    playSectionVoice(meditationGuide.currentSection + 1);
                }
            }
        }

        function showCompletionSection() {
            completionSection.style.display = 'flex';
            showNotification(`âœ¨ å†¥æƒ³å¼•å¯¼å®Œæˆï¼ç°åœ¨å¯ä»¥è¿›å…¥ä½ çš„${currentPlanet ? currentPlanet.year : '2026'}æ˜Ÿçƒäº†ã€‚`);
        }

        function enterPlanet() {
            enterPlanetBtn.disabled = true;
            enterPlanetBtn.innerHTML = '<i class="fas fa-spinner fa-spin btn-icon"></i> è¿›å…¥ä¸­...';
            
            const year = currentPlanet ? currentPlanet.year : new Date().getFullYear();
            showNotification(`ğŸš€ æ­£åœ¨è¿›å…¥${year}æ˜Ÿçƒ...`);
            
            // æ›´æ–°æ˜ŸçƒçŠ¶æ€
            if (currentPlanet) {
                currentPlanet.meditationCompleted = true;
                currentPlanet.meditationCompletedAt = Date.now();
                savePlanet(currentPlanet);
            }
            
            setTimeout(() => {
                window.location.href = `dreamfragment.html?year=${year}`;
            }, 2000);
        }
    </script>
</body>
</html>
