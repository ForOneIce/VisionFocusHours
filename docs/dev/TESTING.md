# VisionFocus Hours - 星球流程测试指南

## 🎯 测试目标
验证星球创建后的完整流程,确保用户在未完成冥想时点击星球能重新进入冥想引导。

---

## 🚀 启动服务器

```bash
cd VisionFocusHours/src
python -m http.server 3000
```

访问: `http://localhost:3000/index.html`

---

## ✅ 测试步骤

### 1. 初始状态测试

1. 打开应用,会自动跳转到 `home.html`
2. 观察页面:
   - ✅ 右上角显示"未连接钱包"
   - ✅ 没有看到"新星球"按钮 (需要先连接钱包)
   - ✅ 可能显示示例星球 (如果没有真实数据)

### 2. 钱包连接测试

1. 点击右上角"连接钱包"按钮
2. 在弹出的模态框中选择"MetaMask"
3. MetaMask扩展会弹出授权请求
4. 点击"授权"
5. 观察结果:
   - ✅ 右上角显示"已连接"和钱包地址
   - ✅ 宇宙中出现一个"新星球"按钮 (带+号)
   - ✅ 右上角显示"断开连接"按钮

### 3. 创建星球测试

1. 点击中间的"新星球"按钮 (带+号)
2. 观察流程:
   - ✅ 显示通知: "星球创建成功!"
   - ✅ 1秒后显示: "即将开始冥想引导"
   - ✅ 自动跳转到 `meditation.html?year=2026`

### 4. 冥想引导测试

1. 进入冥想引导页面
2. 观察初始界面:
   - ✅ 显示"2026星球 · 冥想引导"标题
   - ✅ 显示星球动画
   - ✅ 显示"开始冥想引导"按钮

3. 点击"开始冥想引导"按钮
4. 观察动画:
   - ✅ 星球放大,宇宙聚焦动画
   - ✅ 3秒后切换到冥想空间
   - ✅ 显示第一阶段: "冥想准备与开场"
   - ✅ 背景音乐开始播放
   - ✅ 呼吸圆圈开始动画

5. 测试控制功能:
   - ✅ 点击"手动引导": 显示所有文字
   - ✅ 点击"自动引导": 文字逐行显示
   - ✅ 点击"下一阶段": 跳转到下一个阶段
   - ✅ 点击底部进度指示器: 跳转到指定阶段
   - ✅ 按空格键: 切换自动/手动模式
   - ✅ 按M键: 音乐开关
   - ✅ 按左右箭头键: 切换阶段

6. **关键测试: 中断冥想**
   - ❗ **在冥想进行到一半时,关闭页面或刷新页面**
   - ✅ 冥想状态应该**未保存** (meditationCompleted = false)

### 5. 返回首页测试 (关键!)

1. 在浏览器中输入: `http://localhost:3000/pages/home.html`
2. 观察宇宙视图:
   - ✅ 应该能看到2026年的星球
   - ✅ 星球下方显示徽章: "🧘 待冥想"
   - ✅ 徽章颜色为金色边框

3. **点击这个2026星球**
4. 观察结果:
   - ✅ 显示通知: "需要完成冥想引导"
   - ✅ 显示通知: "正在进入冥想流程..."
   - ✅ 自动跳转到 `meditation.html?year=2026`
   - ✅ 重新进入冥想引导页面

### 6. 完成冥想测试

1. 在冥想引导页面,快速跳转到最后一个阶段:
   - 点击底部进度指示器的第5个点 (回归)
   
2. 或者耐心等待自动播放完成所有阶段

3. 观察完成界面:
   - ✅ 显示"冥想引导完成"标题
   - ✅ 显示完成文案
   - ✅ 显示"进入星球内部"按钮

4. 点击"进入星球内部"按钮
5. 观察结果:
   - ✅ 显示加载动画
   - ✅ 按钮文字变为"进入中..."
   - ✅ 2秒后跳转到 `dreamfragment.html?year=2026`
   - ✅ **星球状态已保存** (meditationCompleted = true)

### 7. 再次返回首页测试

1. 返回 `home.html`
2. 观察2026星球:
   - ✅ 徽章变为: "💭 设定愿景"
   - ✅ 徽章颜色变为青色边框
   - ✅ 表示已完成冥想,待设定愿景碎片

3. **点击2026星球**
4. 观察结果:
   - ✅ 显示通知: "进入2026星球"
   - ✅ 显示通知: "继续设定愿景碎片..."
   - ✅ 跳转到 `dreamfragment.html?year=2026`
   - ✅ **不再跳转到冥想页面了!**

---

## 🔍 数据验证

### 打开浏览器开发者工具 (F12)

1. 切换到 **Application** 或 **存储** 标签
2. 展开 **Local Storage** → `http://localhost:3000`
3. 查看存储的键值:

#### 未完成冥想时:
```json
vfh_planets: [
  {
    "year": 2026,
    "createdAt": 1704326400000,
    "meditationCompleted": false,
    "meditationCompletedAt": null,
    "dreamFragmentsCompleted": false,
    "visionBoardCompleted": false,
    "wishes": [],
    "totalHours": 0
  }
]
```

#### 完成冥想后:
```json
vfh_planets: [
  {
    "year": 2026,
    "createdAt": 1704326400000,
    "meditationCompleted": true,
    "meditationCompletedAt": 1704327000000,
    "dreamFragmentsCompleted": false,
    "visionBoardCompleted": false,
    "wishes": [],
    "totalHours": 0
  }
]
```

---

## 🐛 常见问题排查

### 问题1: 点击星球没有反应
**解决**: 
- 检查浏览器控制台是否有错误
- 确认 `storage.js` 正确加载
- 检查星球数据是否正确保存

### 问题2: 刷新页面后状态丢失
**解决**:
- 检查 LocalStorage 是否被清空
- 确认 `storageManager.savePlanet()` 被调用
- 查看浏览器隐私模式是否阻止存储

### 问题3: 完成冥想后仍然跳转到冥想页面
**解决**:
- 检查 `meditation.js` 的 `enterPlanet()` 函数
- 确认 `meditationCompleted` 字段被正确设置为 `true`
- 检查 `meditationCompletedAt` 时间戳是否保存

### 问题4: 徽章不显示或显示错误
**解决**:
- 检查 `home.html` 的 `renderPlanets()` 函数
- 确认 `storageManager.getPlanet(year)` 返回正确数据
- 检查徽章样式是否正确应用

---

## ✨ 预期结果总结

| 状态 | 徽章显示 | 点击行为 | 跳转页面 |
|------|---------|---------|---------|
| 刚创建 | 🧘 待冥想 | 进入冥想流程 | meditation.html |
| 冥想中断 | 🧘 待冥想 | 重新进入冥想 | meditation.html |
| 冥想完成 | 💭 设定愿景 | 设定愿景碎片 | dreamfragment.html |
| 碎片完成 | 🎨 创建愿景板 | 创建愿景板 | visionboard.html |
| 全部完成 | ✨ X小时 | 查看专注记录 | hoursputin.html |

---

## 🎉 测试通过标准

- ✅ 创建星球后自动进入冥想
- ✅ 未完成冥想时,点击星球重新进入冥想
- ✅ 完成冥想后,点击星球进入下一步流程
- ✅ 星球徽章正确显示当前状态
- ✅ 状态持久化保存到 LocalStorage
- ✅ 页面刷新后状态不丢失
- ✅ 流程顺序符合产品设计

---

## 📝 下一步开发

完成此测试后,继续开发:
1. ✅ 愿景碎片页面 (`dreamfragment.html`)
2. ✅ 愿景板页面 (`visionboard.html`)
3. ✅ 专注时光投入页面 (`hoursputin.html`)
4. ✅ NFT页面 (`nft.html`)

